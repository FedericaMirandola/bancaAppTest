
#configurazione DB postgres
quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5437/bancaDB
quarkus.datasource.username=user
quarkus.datasource.password=password

# --- Gestione Schema con Hibernate ORM per i Test ---
# 'drop-and-create' pulisce e ricrea lo schema a ogni avvio dei test,
# garantendo un ambiente pulito e riproducibile per ogni esecuzione.
#quarkus.hibernate-orm.database.generation=drop-and-create

# --- Flyway (Disabilitato per i Test) ---
# Flyway è tipicamente disabilitato nei test quando Hibernate gestisce lo schema
# tramite 'drop-and-create' per evitare conflitti o complessità inutili.
quarkus.flyway.clean-at-start=true
quarkus.flyway.baseline-on-migrate=true
quarkus.flyway.migrate-at-start=true

# --- Configurazioni per Scheduler (se usate nei test) ---
# Mantieni queste impostazioni se i tuoi test unitari/di integrazione dipendono
# dal comportamento di questi scheduler. Altrimenti, potresti commentarli.
quarkus.scheduler.enabled=true
scheduler.load-from-file=true
movimenti.scaricamento.cron=0 0 2 * * ?
#movimenti.scaricamento.cron=*/10 * * * * ?
scheduler.daysback=1
scheduler.test-data.filenames=transaction_page_1.json,transaction_page_2.json,transaction_page_3.json

# --- Configurazioni Client REST (Mock/Fake per i Test) ---
# È buona pratica usare URL mock/fake per i client REST nei test per isolare
# il tuo codice dalle dipendenze esterne. Le tue configurazioni attuali sono perfette.

# Esempio: Disabilita URL reali e usa un URL mock per 'credem-api'
#quarkus.rest-client.credem-api.url=https://sandbox.credem.it/psd2/v1
credem-api/mp-rest/url=http://localhost:8080

# Altre configurazioni mock per Credem e CBI
credem.account-id=IT001000000000000000001
credem.psu-id=PR-00000000-001-00013384-IH
use.fake.credem=true
transaction.source=mock

cbi.client-id=my-mock-client-id
cbi.client-secret=my-mock-client-secret
cbi.auth-url=http://localhost:8080/oauth/token
cbi.token=fake-mock-bearer-token
cbi-auth/mp-rest/url=http://localhost:8080
cbi.consent-mock-id=mock-consent-id-1234abcde


# --- Configurazione specifica per il profilo 'test' ---
%test.quarkus.flyway.enabled=true
%test.quarkus.flyway.clean-at-start=true
%test.quarkus.flyway.migrate-at-start=true
%test.quarkus.flyway.validate-on-migrate=false
%test.quarkus.flyway.baseline-on-migrate=true

%test.quarkus.flyway.locations=classpath:db/migration

%test.quarkus.hibernate-orm.database.generation=none
%test.quarkus.hibernate-orm.dialect=org.hibernate.dialect.PostgreSQLDialect

%test.quarkus.datasource.devservices.enabled=false
%test.quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5437/bancaDB
%test.quarkus.datasource.username=user
%test.quarkus.datasource.password=password

# Logging ESTREMAMENTE dettagliato per Flyway 
%test.quarkus.log.category."org.flywaydb".level=TRACE
%test.quarkus.log.category."io.quarkus.flyway".level=TRACE
%test.log.category."org.hibernate.SQL".level=DEBUG
%test.log.category."org.hibernate.orm.jdbc.bind".level=TRACE
%test.log.category."org.hibernate.tool.schema".level=DEBUG

# Configurazione per l'autenticazione basata su file di proprietà
quarkus.security.users.embedded.enabled=true
quarkus.security.users.embedded.users.admin=adminpassword
quarkus.security.users.embedded.users.user=userpassword

# Definizione dei ruoli per ciascun utente
quarkus.security.users.embedded.roles.admin=admin,user
quarkus.security.users.embedded.roles.user=user

# Abilita l'autenticazione HTTP Basic (molto comune per API REST)
quarkus.http.auth.basic=true

# Protegge tutti gli endpoint sotto /movimenti 
# Se vuoi che solo gli utenti 'user' e 'admin' possano accedere ai movimenti:
quarkus.http.auth.permission.transactions.paths=/transactions/*
quarkus.http.auth.permission.transactions.roles=user,admin
quarkus.security.users.embedded.plain-text=true
quarkus.http.auth.permission.transactions.policy=authenticated

quarkus.log.level=INFO
quarkus.log.category."it.coderit.banktestapp.scheduler".level=INFO
quarkus.log.category."it.coderit.banktestapp.service".level=INFO
quarkus.log.category."org.flywaydb".level=INFO
quarkus.log.category."it.coderit.banktestapp".level=DEBUG